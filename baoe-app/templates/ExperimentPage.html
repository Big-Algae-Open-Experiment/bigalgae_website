{% extends "Base.html" %}
{% block title %}Experiment {{ experiment_dict['id'] }} - Big Algae Open Experiment{% endblock %}
{% block head %}
    {{ super() }}
    <style type="text/css">
        .social iframe {
            vertical-align: middle;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function() {
            var file_name_input = $('#file_name_input');
            var submit_button = $('input[value="SUBMIT DRY MASS"]');
            submit_button.prop('disabled', true);
            $('.measurement_entry').click(function(e) {
                var file_name = $(this).attr('file_name');
                file_name_input.attr('value', file_name);
                submit_button.prop('disabled', false);
                $('#add_dry_mass').addClass('in');
            })
        });
    </script>
    <script src="{{ url_for('static', filename='js/qrcode.min.js') }}" charset="utf-8"></script>
{% endblock %}
{% block body %}
    {{ super() }}
    
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <a href="{{ url_for('reactor', reactor_id=reactor_id) }}"><h2>Reactor {{ reactor_id }}</h2></a>
                <h4>Experiment {{ experiment_dict['id'] }}</h4>
                <h4>Species: {{ experiment_dict['species'] }}</h4>
                <h4>Number of Measurement: {{ experiment_dict['measurements']|length }}</h4>
                <ul>
                    {% for measurement in experiment_dict['measurements'] %}
                        <li class="measurement_entry" file_name="{{ measurement['file_name'] }}"><a>{{ measurement['file_name'] }}</a>
                        <ul>
                            <li>Cell count: {{ measurement['cell_count'] }}</li>
                            <li>OD680: {{ measurement['od680'] }}</li>
                            <li>OD750: {{ measurement['od750'] }}</li>
                            <li>Dry Mass: {{ measurement['dry_mass'] }}</li>
                            {% if 'DateTime' in measurement['exif'].keys() %}
                                <li>Taken: {{ measurement['exif']['DateTime'] }}</li>
                            {% endif %}
                        </ul>
                        </li>
                    {% endfor %}
                </ul>
                <div class="panel-group" id="accordion">
                    <div class="panel panel-default">
                        <div data-toggle="collapse" data-parent="#accordion" data-target="#add_dry_mass" class="panel-heading" style="cursor: pointer;">
                            <h4 class="panel-title">Add dry mass measurements (Click here to expand)</h4>
                        </div>
                        <div id="add_dry_mass" class="panel-collapse collapse {% if incorrect_password_dry_mass or dry_mass_thanks%}in{% endif %}">
                            <div class="panel-body">
                                {% if incorrect_password_dry_mass %}
                                    <div class="alert alert-danger" role="alert">
                                        <p>Sorry, your experiment validation code was incorrect, please try again.</p>
                                    </div>
                                {% endif %}
                                {% if dry_mass_thanks %}
                                    <div class="alert alert-success" role="alert">
                                        <p>Thank you for updating a measurement with dry mass information!</p>
                                    </div>
                                {% endif %}
                                <p>Please separate repeat measurements with a comma e.g. 123.45,678.90,123.45</p>
                                <form id="form" method="post">
                                    <div class="form-group">
                                        <label for="file_name_input">File Name</label>
                                        <input readonly="readonly" type="name" class="form-control" name="file_name_input" id="file_name_input">
                                    </div>
                                    <div class="form-group">
                                        <label for="dry_mass">Dry mass (g / l)</label>
                                        <input type="name" class="form-control" name="dry_mass" id="dry_mass">
                                    </div>
                                    <div class="form-group">
                                        <label for="upload_validation">4 digit Upload Code</label>
                                        <input type="name" class="form-control" name="upload_validation" id="upload_validation" required>
                                    </div>
                                    <center><input type="submit" class="btn btn-success" name="submit_button" value="SUBMIT DRY MASS"></center>
                                </form>                         
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div data-toggle="collapse" data-parent="#accordion" data-target="#qr_code" class="panel-heading" style="cursor: pointer;">
                            <h4 class="panel-title">Display QR Code (Click here to expand)</h4>
                        </div>
                        <div id="qr_code" class="panel-collapse collapse">
                            <div class="panel-body">
                                <p>This QR code links to this reactor page</p>
                                <div id='qrcode'></div>
                                <script type="text/javascript">
                                    new QRCode(document.getElementById("qrcode"),
                                            window.location.href);
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
            <div class="col-md-6">
                <h2>Upload</h2>
                {% if incorrect_upload_code %}
                    <div class="alert alert-danger" role="alert">
                        <p>Sorry, your upload code was incorrect, please try again.</p>
                    </div>
                {% endif %}
                {% if twitter_thanks %}
                    <div class="alert alert-success" role="alert">
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        <p>Thanks so much for submitting a measurement! Share this on Twitter: <span class='social'><a href="https://twitter.com/share" class="twitter-share-button"{count} data-text="I just uploaded a measurement as part of the @bigalgae Open Experiment!" data-hashtags="bigalgae"></a></span></p>
                    </div>
                {% endif %}
                <form enctype="multipart/form-data" action="" method="post">
                    <div class="form-group">
                        <label class="btn btn-primary" for="upload_picture">
                            <input type='file' style="display:none;" capture='camera' accept='image/*' name='upload_picture' id='upload_picture' required>
                        Upload Image    
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="upload_validation">4 digit Upload Code</label>
                        <input type="name" class="form-control" name="upload_validation" id="upload_validation" required>
                    </div>

                    <div class="panel-group">
                        <div class="panel panel-default">
                            <div data-toggle="collapse" data-target="#advanced_measurements" class="panel-heading">
                                <h4 class="panel-title">Advanced Measurements (Click here to expand)</h4>
                            </div>
                            <div id="advanced_measurements" class="panel-collapse collapse" style="cursor: pointer;">
                                <div class="panel-body">
                                    <p>Please separate repeat measurements with a comma e.g. 123.45,678.90,123.45</p>
                                    <div class="form-group">
                                        <label for="cell_count">Cell count (cells / ml)</label>
                                        <input type="name" class="form-control" name="cell_count" id="cell_count">
                                    </div>
                                    <div class="form-group">
                                        <label for="cell_count">Optical density 680nm</label>
                                        <input type="name" class="form-control" name="od680" id="od680">
                                    </div>
                                    <div class="form-group">
                                        <label for="cell_count">Optical density 750nm</label>
                                        <input type="name" class="form-control" name="od750" id="od750">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <center><input type="submit" class="btn btn-success" name="submit_button" value="SUBMIT IMAGE"></center>
                </form>
            </div> 
        </div>
    </div>

{% endblock %}